<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MH Towing - Distance & Price Calculator</title>
    <link rel="stylesheet" href="calculator-styles.css">
    <script>
        const GOOGLE_MAPS_API_KEY = 'AIzaSyArc6Vzj2uzOK29RVvIJePIN9bS6yLPv1E';
        
        if (GOOGLE_MAPS_API_KEY && GOOGLE_MAPS_API_KEY !== 'YOUR_API_KEY_HERE') {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places&callback=initMap`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="company-info">
                <h1>MH TOWING</h1>
                <div class="company-details">
                    <div>üìû 061 453 2160</div>
                </div>
            </div>
            <h2>üßÆ Distance & Price Calculator</h2>
        </header>

        <div class="calculator-card">
            <!-- Location Inputs -->
            <div class="section">
                <h3>üìç Locations</h3>
                <div class="route-type-selector">
                    <label>
                        <input type="radio" name="routeType" value="simple" checked onchange="toggleRouteType()">
                        Simple Route (Pickup ‚Üí Delivery)
                    </label>
                    <label>
                        <input type="radio" name="routeType" value="workshop" onchange="toggleRouteType()">
                        From Workshop (Workshop ‚Üí Pickup ‚Üí Delivery)
                    </label>
                </div>
                
                <!-- Workshop Location (hidden by default) -->
                <div id="workshopSection" style="display: none;">
                    <div class="form-group">
                        <label>Workshop Location</label>
                        <input type="text" id="workshopLocation" placeholder="Your workshop address..." value="784 Gopalall Hurbans, Tongaat">
                        <button class="btn-gps" onclick="getLocation('workshop')">üìç Use GPS</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>From (Pickup)</label>
                    <input type="text" id="fromLocation" placeholder="Start typing address...">
                    <button class="btn-gps" onclick="getLocation('from')">üìç Use GPS</button>
                </div>
                <div class="form-group">
                    <label>To (Drop-off)</label>
                    <input type="text" id="toLocation" placeholder="Start typing address...">
                    <button class="btn-gps" onclick="getLocation('to')">üìç Use GPS</button>
                </div>
                <button class="btn-calculate-route" onclick="manualCalculate()">üßÆ Calculate Distance</button>
            </div>

            <!-- Distance Display -->
            <div class="section result-section">
                <h3>üìè Distance</h3>
                <div id="simpleDistance">
                    <div class="distance-display">
                        <span class="distance-value" id="distanceValue">0.00</span>
                        <span class="distance-unit">km</span>
                    </div>
                </div>
                <div id="workshopDistance" style="display: none;">
                    <div class="distance-breakdown">
                        <div class="distance-leg">
                            <span class="leg-label">üè≠ Workshop ‚Üí Pickup:</span>
                            <span class="leg-value" id="workshopToPickup">0.00 km</span>
                        </div>
                        <div class="distance-leg">
                            <span class="leg-label">üöó Pickup ‚Üí Delivery:</span>
                            <span class="leg-value" id="pickupToDelivery">0.00 km</span>
                        </div>
                        <div class="distance-leg">
                            <span class="leg-label">üîô Return to Workshop:</span>
                            <span class="leg-value" id="returnToWorkshop">0.00 km</span>
                        </div>
                        <div class="distance-divider"></div>
                        <div class="distance-leg total-distance">
                            <span class="leg-label">üìä Total Distance:</span>
                            <span class="leg-value" id="totalDistance">0.00 km</span>
                        </div>
                    </div>
                </div>
                <div class="manual-distance">
                    <label>
                        <input type="checkbox" id="manualDistanceToggle" onchange="toggleManualDistance()">
                        Enter distance manually
                    </label>
                    <div id="manualDistanceInput" style="display: none; margin-top: 10px;">
                        <input type="number" id="manualDistance" step="0.1" placeholder="Enter km" 
                               style="width: 100%; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 16px;"
                               oninput="updateManualDistance()">
                    </div>
                </div>
            </div>

            <!-- Route Options -->
            <div class="section route-section" id="routeSection" style="display: none;">
                <h3>üó∫Ô∏è Route Options</h3>
                <div id="routeOptions" class="route-options"></div>
                <div id="map" style="width: 100%; height: 300px; border-radius: 8px; margin-top: 15px;"></div>
            </div>

            <!-- Pricing Section -->
            <div class="section">
                <h3>üí∞ Pricing</h3>
                <div class="pricing-options">
                    <div class="pricing-row">
                        <label>Base Rate (R)</label>
                        <input type="number" id="baseRate" value="350" step="10">
                    </div>
                    <div class="pricing-row">
                        <label>Per KM Rate (R)</label>
                        <input type="number" id="perKmRate" value="25" step="1">
                    </div>
                    <div class="pricing-row">
                        <label>Service Type</label>
                        <select id="serviceType" onchange="updatePricing()">
                            <option value="1">Standard Tow</option>
                            <option value="1.2">Heavy Duty (+20%)</option>
                            <option value="1.5">Accident Recovery (+50%)</option>
                            <option value="0.8">Local Tow (-20%)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Fuel Cost Section -->
            <div class="section fuel-section">
                <h3>‚õΩ Fuel Cost Calculator</h3>
                <div class="pricing-options">
                    <div class="pricing-row">
                        <label>Calculation Method</label>
                        <select id="fuelMethod" onchange="toggleFuelMethod()">
                            <option value="consumption">Detailed Consumption</option>
                            <option value="fixed">Fixed Cost per KM</option>
                            <option value="percentage">Percentage of Revenue</option>
                            <option value="manual">Manual Entry</option>
                        </select>
                    </div>
                    
                    <!-- Consumption Method -->
                    <div id="consumptionMethod" class="fuel-method-section">
                        <div class="method-description">
                            üìä Most accurate method - calculates based on actual vehicle consumption
                        </div>
                        <div class="pricing-row">
                            <label>Vehicle Type</label>
                            <select id="vehicleType" onchange="updateVehicleConsumption()">
                                <option value="custom">Custom</option>
                                <option value="light-truck">Light Tow Truck (12 L/100km)</option>
                                <option value="medium-truck" selected>Medium Tow Truck (15 L/100km)</option>
                                <option value="heavy-truck">Heavy Tow Truck (20 L/100km)</option>
                                <option value="flatbed">Flatbed Truck (18 L/100km)</option>
                                <option value="recovery">Recovery Vehicle (22 L/100km)</option>
                                <option value="super-heavy">Super Heavy Duty (28 L/100km)</option>
                            </select>
                        </div>
                        <div class="pricing-row">
                            <label>Fuel Price (R/L)</label>
                            <input type="number" id="fuelPrice" value="24.50" step="0.10" oninput="updatePricing()">
                        </div>
                        <div class="pricing-row">
                            <label>Base Consumption (L/100km)</label>
                            <input type="number" id="fuelConsumption" value="15" step="0.5" oninput="updatePricing()">
                            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                üí° Preset values are editable - adjust based on your actual vehicle
                            </small>
                        </div>
                        <div class="pricing-row">
                            <label>Load Factor</label>
                            <select id="loadFactor" onchange="updatePricing()">
                                <option value="1">Empty Truck (√ó1.0)</option>
                                <option value="1.15" selected>Light Load (√ó1.15)</option>
                                <option value="1.3">Medium Load (√ó1.3)</option>
                                <option value="1.5">Heavy Load (√ó1.5)</option>
                                <option value="1.8">Towing Heavy Vehicle (√ó1.8)</option>
                            </select>
                        </div>
                        <div class="pricing-row">
                            <label>Terrain Factor</label>
                            <select id="terrainFactor" onchange="updatePricing()">
                                <option value="1" selected>Flat/Highway (√ó1.0)</option>
                                <option value="1.1">Mixed Terrain (√ó1.1)</option>
                                <option value="1.25">Hilly/Mountain (√ó1.25)</option>
                                <option value="1.15">City/Stop-Start (√ó1.15)</option>
                            </select>
                        </div>
                        <div class="pricing-row">
                            <label>
                                <input type="checkbox" id="includeIdling" onchange="updatePricing()">
                                Include Idling Time (adds 10%)
                            </label>
                        </div>
                        <div class="fuel-breakdown">
                            <div class="breakdown-item">
                                <span>Base Fuel:</span>
                                <span id="baseFuelCost">R 0.00</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Load Adjustment:</span>
                                <span id="loadAdjustment">R 0.00</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Terrain Adjustment:</span>
                                <span id="terrainAdjustment">R 0.00</span>
                            </div>
                            <div class="breakdown-item" id="idlingCostRow" style="display: none;">
                                <span>Idling Cost:</span>
                                <span id="idlingCost">R 0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fixed Cost Method -->
                    <div id="fixedMethod" class="fuel-method-section" style="display: none;">
                        <div class="method-description">
                            üí° Simple method - use your average cost per kilometer
                        </div>
                        <div class="pricing-row">
                            <label>Fixed Cost per KM (R)</label>
                            <input type="number" id="fixedCostPerKm" value="3.50" step="0.10" oninput="updatePricing()">
                        </div>
                        <div class="pricing-row">
                            <label>Include Return Trip</label>
                            <select id="returnTrip" onchange="updatePricing()">
                                <option value="1">One Way Only</option>
                                <option value="2">Round Trip (√ó2)</option>
                                <option value="1.5">Return Empty (√ó1.5)</option>
                            </select>
                        </div>
                        <div class="fuel-info">
                            üí° Tip: Calculate your average by dividing monthly fuel costs by total kilometers driven
                        </div>
                    </div>
                    
                    <!-- Percentage Method -->
                    <div id="percentageMethod" class="fuel-method-section" style="display: none;">
                        <div class="method-description">
                            üìà Business planning method - fuel as percentage of revenue
                        </div>
                        <div class="pricing-row">
                            <label>Fuel % of Revenue</label>
                            <input type="number" id="fuelPercentage" value="15" step="1" min="0" max="100" oninput="updatePricing()">
                        </div>
                        <div class="pricing-row">
                            <label>Include Other Costs</label>
                            <select id="otherCosts" onchange="updatePricing()">
                                <option value="0">Fuel Only</option>
                                <option value="5">+ Maintenance (5%)</option>
                                <option value="10">+ Maintenance & Wear (10%)</option>
                                <option value="15">+ All Operating Costs (15%)</option>
                            </select>
                        </div>
                        <div class="fuel-breakdown">
                            <div class="breakdown-item">
                                <span>Fuel Cost:</span>
                                <span id="percentageFuelCost">R 0.00</span>
                            </div>
                            <div class="breakdown-item" id="otherCostsRow" style="display: none;">
                                <span>Other Costs:</span>
                                <span id="otherCostsAmount">R 0.00</span>
                            </div>
                        </div>
                        <div class="fuel-info">
                            üí° Industry average: 12-18% for fuel, 25-35% for total operating costs
                        </div>
                    </div>
                    
                    <!-- Manual Method -->
                    <div id="manualMethod" class="fuel-method-section" style="display: none;">
                        <div class="method-description">
                            ‚úèÔ∏è Enter exact fuel cost - for actual fill-up calculations
                        </div>
                        <div class="pricing-row">
                            <label>Total Fuel Cost (R)</label>
                            <input type="number" id="manualFuelCost" value="0" step="10" oninput="updatePricing()">
                        </div>
                        <div class="pricing-row">
                            <label>Add Buffer</label>
                            <select id="fuelBuffer" onchange="updatePricing()">
                                <option value="0">No Buffer</option>
                                <option value="5">+5% Safety Margin</option>
                                <option value="10">+10% Safety Margin</option>
                                <option value="15">+15% Safety Margin</option>
                            </select>
                        </div>
                        <div class="fuel-info">
                            üí° Tip: Fill up before job, note odometer. Fill up after, calculate difference.
                        </div>
                    </div>
                    
                    <div class="fuel-result">
                        <div class="fuel-label">Total Fuel Cost:</div>
                        <div class="fuel-value" id="fuelCost">R 0.00</div>
                    </div>
                </div>
            </div>

            <!-- Total Price Display -->
            <div class="section total-section">
                <div class="total-breakdown">
                    <div class="breakdown-row">
                        <span>Base Rate:</span>
                        <span id="baseRateDisplay">R 350.00</span>
                    </div>
                    <div class="breakdown-row">
                        <span>Distance (<span id="kmDisplay">0.00</span> km √ó R <span id="rateDisplay">25</span>):</span>
                        <span id="distanceCostDisplay">R 0.00</span>
                    </div>
                    <div class="breakdown-row">
                        <span>Service Multiplier:</span>
                        <span id="multiplierDisplay">√ó1.0</span>
                    </div>
                    <div class="breakdown-divider"></div>
                    <div class="breakdown-row subtotal-row">
                        <span>CUSTOMER PRICE:</span>
                        <span id="totalPrice">R 350.00</span>
                    </div>
                    <div class="breakdown-divider"></div>
                    <div class="breakdown-row fuel-row">
                        <span>Your Fuel Cost:</span>
                        <span id="fuelCostDisplay">R 0.00</span>
                    </div>
                    <div class="breakdown-row profit-row">
                        <span>üí∞ YOUR PROFIT:</span>
                        <span id="profitDisplay">R 350.00</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="actions">
                <button class="btn-calculate" onclick="calculateAll()">üîÑ Recalculate</button>
                <button class="btn-share" onclick="shareQuote()">üì§ Share Quote</button>
                <button class="btn-reset" onclick="resetCalculator()">üîÑ Reset</button>
            </div>

            <!-- Quick Link -->
            <div class="quick-link">
                <a href="index.html">üìã Create Job Card</a>
            </div>
        </div>
    </div>

    <script src="calculator.js"></script>
</body>
</html>
